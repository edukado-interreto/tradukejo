{% extends 'base.html' %}
{% load static %}
{% block title %}{{ project.name }}{% endblock %}

{% block js %}
<script src="{% static 'traduko/js/project.js' %}"></script>
{% endblock %}

{% block content %}
<div class="card mb-4">
	<div class="card-body">
		<h5 class="card-title">
			{% if not project.visible %}<i class="fas fa-eye-slash mr-1" title="Nevidebla projekto"></i>{% endif %}
			{% if project.locked %}<i class="fas fa-lock mr-1" title="Ŝlosita projekto"></i>{% endif %}
			{{ project.name }}
		</h5>
		<div class="row">
			<div class="col">
				{% if project.url %}
					<p class="card-text"><a href="{{ project.url }}">{{ project.url }}</a></p>
				{% endif %}
				{% if project.description %}
					<p class="card-text">{{ project.description }}</p>
				{% endif %}
			</div>
			<div class="col-12 col-md-6">
				<ul class="mb-0">
					{% if is_project_admin %}
						<li><a href="{% url 'edit_project' project.pk %}">Redakti la projekton</a></li>
						<li><a href="{% url 'translate' project.pk project.source_language.code %}">Redakti la tekstojn</a></li>
						{% if translator_request_count > 0 %}
							<li><strong><a href="{% url 'translator_request_list' project.pk %}">Petoj por traduki ({{ translator_request_count }})</a></strong></li>
						{% endif %}
						{% if user.is_superuser %}
							<li><a href="{% url 'admin:traduko_project_change' project.pk %}">Redakti en la administrejo</a></li>
						{% endif %}
					{% endif %}
					<li>Fontolingvo: {{ project.source_language.name }}</li>
					<li>Ĉenoj: {{ project.strings }}</li>
					<li>Vortoj: {{ project.words }}</li>
					<li>Signoj: {{ project.characters }}</li>
					<li>
						Bezonataj lingvoj:
						{% for l in project.needed_languages.all|dictsort:"name" %}<span lang="{{ l.code }}">{{ l.name }}</span>{% if not forloop.last %}, {% endif %}{% empty %}ĉiuj eblaj{% endfor %}.
					</li>
				</ul>
			</div>
		</div>
	</div>
</div>

{% if my_languages_with_stats %}
<h2>{% if is_project_admin %}Lingvoj{% else %}Miaj lingvoj{% endif %}</h2>
<div class="card my-4">
	{% include 'traduko/project/language-version-list.html' with language_versions=my_languages_with_stats can_translate=True %}
</div>
{% endif %}

{% if available_languages_with_stats %}
<h2>Aliaj lingvoj</h2>
<div class="card my-4">
	{% include 'traduko/project/language-version-list.html' with language_versions=available_languages_with_stats can_translate=False %}
</div>
{% endif %}

{% if addible_languages and not project.locked or addible_languages and is_project_admin %}
<h2>Traduki al alia lingvo</h2>
<select name="addLanguage" id="addLanguage" class="form-control">
	<option>Elektu lingvon…</option>
	{% for l in addible_languages %}
		<option lang="{{ l.code }}" dir="{{ l.direction }}"{% if is_project_admin %} data-url="{% url 'add_language_version' project.pk l.code %}"{% else %} data-code="{{ l.code }}" data-language="{{ l.name }}"{% endif %}>{{ l.code }} – {{ l.name }}</option>
	{% endfor %}
</select>
Ĉu vi volas traduki al lingvo, kiu ne estas en ĉi tiu listo? Bonvolu kontakti nin. (TODO)
{% endif %}

{% if not is_project_admin and not project.locked %}
<div class="modal fade" id="translatorRequestModal" tabindex="-1" aria-labelledby="translatorRequestModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form action="{% url 'request_translator_permission' project.pk %}" method="post">
				<div class="modal-header">
					<h5 class="modal-title" id="translatorRequestModalLabel">Peti permeson por traduki</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Fermi">
					<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<p id="requestResult"></p>
					<div class="form-group" id="requestFields">
						{% csrf_token %}
						<p>Vi petas permeson traduki al la lingvo: <strong><span id="requestLanguageName">xx</span> (<span id="requestLanguageCode">xx</span>)</strong>.</p>
						<label for="explanation">Bonvolu klarigi mallonge, kiu vi estas:</label>
						<textarea name="explanation" id="explanation" rows="6" class="form-control" required></textarea>
					</div>
					<input type="hidden" name="language" id="requestLanguageCodeInput">
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Fermi</button>
					<input type="submit" class="btn btn-primary" value="Sendi" id="requestSubmit">
				</div>
			</form>
		</div>
	</div>
</div>
{% endif %}

{% endblock %}

